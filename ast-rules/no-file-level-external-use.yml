id: no-file-level-external-use
language: rust
message: "ファイル先頭での use 文は標準ライブラリ以外禁止 (project_rules.md 2.2)"
note: "関数内での use か、std:: で始まるパッケージのみ許可されます"
severity: info
rule:
  all:
    - pattern: use $IMPORT;
    - not:
        regex: "^use\\s+(std|crate|super)::"
    - not:
        inside:
          kind: function_item
    - not:
        inside:
          kind: impl_item
    - not:
        inside:
          kind: block
    - not:
        inside:
          kind: declaration_list
    - not:
        precedes:
          pattern: "#[derive($$$)]"
